module load cmake gcc cuda
module load nsight-systems   (if needed)

bsub -P cmb138 -nnodes 1 -W 30 -alloc_flags gpumps -Is /bin/bash

jsrun -n 1 -a 1 -c 1 -g 1 <exec>

n # resources sets, where in each resource set:
a # ranks
c # cores
g # gpus

To run with Nsight-system, do 

jsrun -n 2 -a 1 -g 1 nsys profile -o nsys_results --force-overwrite true ./PeleLM3d.gnu.TPROF.MPI.CUDA.ex inputs.3d amr.restart=chek00000

To profile a specific BL_PROFILER region:

jsrun -n 2 -a 1 -g 1 nsys profile -c nvtx -p "PLM::differential_diffusion_update()@*" -e NSYS_NVTX_PROFILER_REGISTER_ONLY=0 -o nsys_results --force-overwrite true ./PeleLM3d.gnu.TPROF.MPI.CUDA.ex inputs.3d max_step=1 amr.restart=chk00000

